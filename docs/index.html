<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2019-10-07 Mon 22:50 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rogue-Like Game in C++17</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Neel Raiyani">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="solarized.min.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Rogue-Like Game in C++17</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgd40cc99">1. Setup</a></li>
<li><a href="#org06a48ab">2. Drawing Player and Moving around</a></li>
<li><a href="#orgc7084c1">3. Entity System</a></li>
<li><a href="#orgd99cb7c">4. Generating a Dungeon</a></li>
<li><a href="#org7774e76">5. Field of View</a></li>
<li><a href="#org95fd8ee">6. Placing Enemies</a></li>
<li><a href="#org81606a3">7. Combat Loop</a></li>
<li><a href="#org978218c">8. User Interface</a></li>
<li><a href="#org68104e5">9. Items and Inventory</a></li>
<li><a href="#org9e744e2">10. Equiping Items</a></li>
<li><a href="#org2d6d3b3">11. Weapons and Targetting</a></li>
<li><a href="#org0f71b10">12. Saving and Loading Game State</a></li>
<li><a href="#org72eacd7">13. Dungeon Delving</a></li>
<li><a href="#org09d6aed">14. Difficulty Curve</a></li>
</ul>
</div>
</nav>
<p>
This file documents my attempts at going through a process of making a Rogue-Like game.<br>
The associated source code lives in <a href="https://github.com/Roy-Fokker/roguelike">GitHub Repo</a>. State of Repository at end of each section is linked-to at bottom of each section.<br>
</p>

<p>
It's written in sort of literal programming format. Documentation is written in Emacs Org-Mode and exported to html which used by github to display this page. As emacs is not being used for any code related purposes, rest of this document ignores this aspect.<br>
</p>

<div id="outline-container-orgd40cc99" class="outline-2">
<h2 id="orgd40cc99"><span class="section-number-2">1</span> Setup</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org3d70e2b" class="outline-3">
<h3 id="org3d70e2b"><span class="section-number-3">1.1</span> Environment Setup</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org499617d" class="outline-4">
<h4 id="org499617d"><span class="section-number-4">1.1.1</span> Tools of the trade:</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Below is listing of tools I am using<br>
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Tool</th>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-right">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Editor</td>
<td class="org-left"><a href="https://code.visualstudio.com/">VSCode</a></td>
<td class="org-right">1.38.1</td>
</tr>

<tr>
<td class="org-left">C++ Toolchain</td>
<td class="org-left"><a href="https://visualstudio.microsoft.com/vs/">Visual Studio 2019 Community</a></td>
<td class="org-right">16.3.2</td>
</tr>

<tr>
<td class="org-left">C++ Build Generator</td>
<td class="org-left"><a href="https://cmake.org/">CMake</a></td>
<td class="org-right">3.15.1</td>
</tr>

<tr>
<td class="org-left">C++ Package Manager</td>
<td class="org-left"><a href="https://github.com/Microsoft/vcpkg">vcpkg</a></td>
<td class="org-right">2019.09</td>
</tr>

<tr>
<td class="org-left">Version Control</td>
<td class="org-left"><a href="https://git-scm.com/">git</a></td>
<td class="org-right">2.23.0</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org90d7937" class="outline-4">
<h4 id="org90d7937"><span class="section-number-4">1.1.2</span> Editor Configuration</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
Following extensions are installed in VSCode<br>
</p>
<ul class="org-ul">
<li><a href="https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2">Bracket Pair Colorizer 2</a><br></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">C/C++</a><br></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=maddouri.cmake-tools-helper">CMake Tools Helper</a><br>
This will installed 2 other extensions<br>
<ul class="org-ul">
<li><a href="https://marketplace.visualstudio.com/items?itemName=vector-of-bool.cmake-tools">CMake Tools</a><br></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=twxs.cmake">CMake for Visual Studio Code</a><br></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgb19ec7d" class="outline-4">
<h4 id="orgb19ec7d"><span class="section-number-4">1.1.3</span> vcpkg configuration</h4>
<div class="outline-text-4" id="text-1-1-3">
<ul class="org-ul">
<li>Add Environment Variable called VCPKG_ROOT and point it to location of your vcpkg installation directory.<br>
For me this is 'D:\Projects\CPP\.packages\vcpkg'.<br></li>
<li>Add Environment Variable called VCPKG_DEFAULT_TRIPLET and set it equal to x64-&lt;system name&gt;.<br>
Again for me this is 'x64-Windows'.<br></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org0b727c3" class="outline-3">
<h3 id="org0b727c3"><span class="section-number-3">1.2</span> Project Setup</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org584b8a0" class="outline-4">
<h4 id="org584b8a0"><span class="section-number-4">1.2.1</span> Folder Structure</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
This is how i've structured the project folders. The name of the Root Folder doesn't matter, in my case it's called <code>roguelike</code>.<br>
</p>
<pre class="example">
\          # Root folder
\build\    # where cmake will put all build generated files
\docs\     # documentation folder, where this index.html file is located
\src\      # where all the source files will go
\external\ # any 3rd party libraries we can't get via vcpkg will go here
</pre>
</div>
</div>
<div id="outline-container-orga359913" class="outline-4">
<h4 id="orga359913"><span class="section-number-4">1.2.2</span> <code>\.gitignore</code> file</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
We'll be ignore following files and folders. No point in adding these to our git repo.<br>
</p>
<div class="org-src-container">
<pre class="src src-markdown" id="org0ed43bf"><span class="linenr"> 1: </span><span style="color: #b3b3b3;"># </span><span style="color: #50fa7b; font-weight: bold;">cmake build directory</span>
<span class="linenr"> 2: </span>build/
<span class="linenr"> 3: </span>CMakeCache.txt
<span class="linenr"> 4: </span>CMakeFiles/
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #b3b3b3;"># </span><span style="color: #50fa7b; font-weight: bold;">vscode and visual studio specific</span>
<span class="linenr"> 7: </span>.vscode/
<span class="linenr"> 8: </span>.vs/
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #b3b3b3;"># </span><span style="color: #50fa7b; font-weight: bold;">org-mode temp files</span>
<span class="linenr">11: </span>./<span style="color: #b3b3b3;">*</span><span style="font-style: italic;">.html</span>
<span class="linenr">12: </span><span style="font-style: italic;">backups/</span>
<span class="linenr">13: </span><span style="font-style: italic;">.#</span><span style="color: #b3b3b3;">*</span>.org
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf68f115" class="outline-4">
<h4 id="orgf68f115"><span class="section-number-4">1.2.3</span> CMake configuration</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
After you create the CMakeList.txt file below, VSCode should recognize this folder as being CMake project.<br>
It will ask you to choose the toolchain with which to envoke the build process.<br>
CppTools extension in VSCode comes with Ninja as it's build engine, which CMake Tools extension automatically uses.<br>
If you try to run this project from command line, you'll need to add additional parameters telling CMake to generate a VS Solution, instead of Ninja. Or you can install Ninja system-wide. Exercise for the reader.<br>
</p>

<ul class="org-ul">
<li><p>
<code>\CMakeLists.txt</code><br>
This in the root of our project. We define basic things about how cmake should do things.<br>
Lines 3 to 6 tell cmake to use vcpkg toolchain file.<br>
</p>
<div class="org-src-container">
<pre class="src src-cmake" id="org4a14e38"><span class="linenr"> 1: </span><span style="color: #50fa7b; font-weight: bold;">cmake_minimum_required</span><span style="color: #f8f8f2;">(</span>VERSION 3.15.0<span style="color: #f8f8f2;">)</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #ff79c6; font-weight: bold;">if</span><span style="color: #f8f8f2;">(</span>DEFINED ENV<span style="color: #8be9fd;">{</span>VCPKG_ROOT<span style="color: #8be9fd;">}</span> AND NOT DEFINED CMAKE_TOOLCHAIN_FILE<span style="color: #f8f8f2;">)</span>
<span class="linenr"> 4: </span>  <span style="color: #50fa7b; font-weight: bold;">set</span><span style="color: #f8f8f2;">(</span>CMAKE_TOOLCHAIN_FILE <span style="color: #f1fa8c;">"$ENV{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake"</span>
<span class="linenr"> 5: </span>      CACHE STRING <span style="color: #f1fa8c;">""</span><span style="color: #f8f8f2;">)</span>
<span class="linenr"> 6: </span><span style="color: #ff79c6; font-weight: bold;">endif</span><span style="color: #f8f8f2;">()</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #50fa7b; font-weight: bold;">project</span><span style="color: #f8f8f2;">(</span>rogue
<span class="linenr"> 9: </span>        LANGUAGES CXX 
<span class="linenr">10: </span>        VERSION 0.1.0<span style="color: #f8f8f2;">)</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #50fa7b; font-weight: bold;">set</span><span style="color: #f8f8f2;">(</span>CMAKE_CXX_STANDARD_REQUIRED ON<span style="color: #f8f8f2;">)</span>
<span class="linenr">13: </span><span style="color: #50fa7b; font-weight: bold;">set</span><span style="color: #f8f8f2;">(</span>EXECUTABLE_OUTPUT_PATH <span style="color: #f1fa8c;">"${</span><span style="color: #f8f8f2;">CMAKE_BINARY_DIR</span><span style="color: #f1fa8c;">}/bin/"</span><span style="color: #f8f8f2;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #50fa7b; font-weight: bold;">add_subdirectory</span><span style="color: #f8f8f2;">(</span>src<span style="color: #f8f8f2;">)</span>
<span class="linenr">16: </span>
</pre>
</div></li>
<li><p>
<code>\src\CMakeLists.txt</code><br>
This is in our src directory, here we tell cmake that we want output executable to be named rogue.exe.<br>
We also tell it we want to use C++17 standard. This doesn't actually work with MSVC.<br>
So&#x2026; we have to explictly tell cmake to pass some parameters to MSVC compiler<br>
</p>
<div class="org-src-container">
<pre class="src src-cmake" id="org09a1d42"><span class="linenr"> 1: </span><span style="color: #50fa7b; font-weight: bold;">find_package</span><span style="color: #f8f8f2;">(</span>fmt REQUIRED<span style="color: #f8f8f2;">)</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #50fa7b; font-weight: bold;">add_executable</span><span style="color: #f8f8f2;">(</span>rogue main.cpp<span style="color: #f8f8f2;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #50fa7b; font-weight: bold;">target_compile_features</span><span style="color: #f8f8f2;">(</span>rogue PRIVATE cxx_std_17<span style="color: #f8f8f2;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #50fa7b; font-weight: bold;">target_compile_options</span><span style="color: #f8f8f2;">(</span>rogue
<span class="linenr"> 8: </span>                       PRIVATE 
<span class="linenr"> 9: </span>                       $&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:/W3 /permissive- /Zc:__cplusplus /std:c++17&gt;<span style="color: #f8f8f2;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #50fa7b; font-weight: bold;">target_compile_definitions</span><span style="color: #f8f8f2;">(</span>rogue
<span class="linenr">12: </span>                           PRIVATE
<span class="linenr">13: </span>                           $&lt;$&lt;CONFIG:Debug&gt;:DEBUG _DEBUG&gt;<span style="color: #f8f8f2;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #50fa7b; font-weight: bold;">target_link_libraries</span><span style="color: #f8f8f2;">(</span>rogue PRIVATE fmt::fmt<span style="color: #f8f8f2;">)</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org4a2cdc1" class="outline-4">
<h4 id="org4a2cdc1"><span class="section-number-4">1.2.4</span> CMake Hello World test file</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
Time to test if the Setup is done properly.<br>
</p>

<p>
First, let's install <code>fmtlib</code> from vcpkg. <code>fmtlib</code> is a string formatting library, much easier to use than standard <code>std::cout</code>.<br>
We will get vcpkg to download and build it.<br>
</p>
<div class="org-src-container">
<pre class="src src-bat"><span class="linenr">1: </span>vcpkg install fmt
</pre>
</div>

<p>
Next, let's create a simple <code>\src\main.cpp</code> file, to test build configuration.<br>
We will use <code>std::chrono</code> to get current timepoint, and print that with <code>fmt::print</code>.<br>
</p>
<div class="org-src-container">
<pre class="src src-cpp"><span class="linenr"> 1: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">iostream</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr"> 2: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">fmt/core.h</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr"> 3: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">chrono</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr"> 4: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">string</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #bd93f9;">int</span> <span style="color: #50fa7b; font-weight: bold;">main</span><span style="color: #f8f8f2;">()</span>
<span class="linenr"> 7: </span><span style="color: #f8f8f2;">{</span>
<span class="linenr"> 8: </span>    <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">tp</span> = <span style="color: #8be9fd;">std</span>::<span style="color: #8be9fd;">chrono</span>::<span style="color: #8be9fd;">system_clock</span>::now<span style="color: #8be9fd;">()</span>;
<span class="linenr"> 9: </span>    <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">now_c</span> = <span style="color: #8be9fd;">std</span>::<span style="color: #8be9fd;">chrono</span>::<span style="color: #8be9fd;">system_clock</span>::to_time_t<span style="color: #8be9fd;">(</span>tp<span style="color: #8be9fd;">)</span>;
<span class="linenr">10: </span>    <span style="color: #8be9fd;">fmt</span>::print<span style="color: #8be9fd;">(</span><span style="color: #f1fa8c;">"Hello, World! {}"</span>, now_c<span style="color: #8be9fd;">)</span>;
<span class="linenr">11: </span><span style="color: #f8f8f2;">}</span>
</pre>
</div>

<p>
If all of the above is done properly the file below should compile and generate an executable.<br>
In VSCode you can start the build process, by click on <code>Build</code> in the <code>status bar</code> or pressing <code>F7</code> key.<br>
It can be executed by calling <code>\build\src\rogue.exe</code> from the project root folder.<br>
</p>
</div>
</div>

<div id="outline-container-orge54408e" class="outline-4">
<h4 id="orge54408e"><span class="section-number-4">1.2.5</span> libTCOD Configuration</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
The above Setup section looks like a lot of work just to get "Hello, World" printed on to console. We could have avoided all of that hassle by not using cmake. But I want to learn cmake, so&#x2026;<br>
</p>

<p>
I going to try to closely follow the tutorials presented at <a href="http://www.rogueliketutorials.com/tutorials/tcod/">Roguelike Tutorials</a> and the variant <a href="https://tomassedovic.github.io/roguelike-tutorial/index.html">Roguelike Tutorials in Rust</a>. We will be using the same library that it is using. Except instead of Python, we'll be in C++.<br>
However, given that we are going to use C++, there is a some setup overhead involved. Specifically, to get <code>libtcod</code> working and linking with our game.<br>
</p>

<p>
We have two options here.<br>
</p>
<ul class="org-ul">
<li>Get the source code and build the library ourselves.<br></li>
<li>Download pre-built package, and use those.<br></li>
</ul>
<p>
Place to go for either option is <a href="https://github.com/libtcod/libtcod">libtcod github repo</a><br>
</p>

<p>
I am going to go with pre-built version. Author of libtcod uses VS2015, which is ABI compatible with our VS2019 setup. So everything should just work. :fingers-crossed:<br>
Having downloaded <a href="https://github.com/libtcod/libtcod/releases/download/1.14.0/libtcod-1.14.0-x86_64-msvc.zip">libtcod 1.14 x64</a>. Now we have to tell cmake where to go to find this library.<br>
I've extracted the contents of the zip file into <code>\external\libtcod-1.14.0-x86_64-msvc</code> folder. I've also added the folder to our gitignore list. We don't need everything in the archive only some parts.<br>
</p>
<div class="org-src-container">
<pre class="src src-markdown" id="org8ba5849"><span class="linenr">15: </span><span style="color: #b3b3b3;"># </span><span style="color: #50fa7b; font-weight: bold;">the prebuilt libtcod files</span>
<span class="linenr">16: </span>external/libtcod-1.14.0-x86_64-msvc/
</pre>
</div>

<p>
Now we create a <code>external\CMakeLists.txt</code> file, this will tell cmake to let us consume this library from our code.<br>
We also put in a custom target, so that cmake will copy the .dll files into same directory as our executable. This way when we run our game, we don't get missing dll errors.<br>
</p>
<div class="org-src-container">
<pre class="src src-cmake" id="org2b9d512"><span class="linenr"> 1: </span><span style="color: #6272a4;"># Add directories for libtcod</span>
<span class="linenr"> 2: </span><span style="color: #50fa7b; font-weight: bold;">set</span><span style="color: #f8f8f2;">(</span>LIBTCOD_DIR <span style="color: #f1fa8c;">"${</span><span style="color: #f8f8f2;">CMAKE_CURRENT_SOURCE_DIR</span><span style="color: #f1fa8c;">}/libtcod-1.14.0-x86_64-msvc"</span><span style="color: #f8f8f2;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #50fa7b; font-weight: bold;">set</span><span style="color: #f8f8f2;">(</span>LIBTCOD_INCLUDE <span style="color: #f1fa8c;">"${</span><span style="color: #f8f8f2;">LIBTCOD_DIR</span><span style="color: #f1fa8c;">}/include/"</span> CACHE PATH <span style="color: #f1fa8c;">"Path to Libtcod Include"</span><span style="color: #f8f8f2;">)</span>
<span class="linenr"> 5: </span><span style="color: #50fa7b; font-weight: bold;">find_library</span><span style="color: #f8f8f2;">(</span>LIBTCOD_LIB libtcod $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_DIR</span><span style="color: #8be9fd;">}</span><span style="color: #f8f8f2;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #50fa7b; font-weight: bold;">add_custom_target</span><span style="color: #f8f8f2;">(</span>libtcod_bins
<span class="linenr"> 8: </span>    COMMAND $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">CMAKE_COMMAND</span><span style="color: #8be9fd;">}</span> -E copy $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_DIR</span><span style="color: #8be9fd;">}</span>/libtcod.dll $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">EXECUTABLE_OUTPUT_PATH</span><span style="color: #8be9fd;">}</span>
<span class="linenr"> 9: </span>    COMMAND $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">CMAKE_COMMAND</span><span style="color: #8be9fd;">}</span> -E copy $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_DIR</span><span style="color: #8be9fd;">}</span>/sdl2.dll $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">EXECUTABLE_OUTPUT_PATH</span><span style="color: #8be9fd;">}</span>
<span class="linenr">10: </span><span style="color: #f8f8f2;">)</span>
</pre>
</div>

<p>
Next, we modify our root <code>CMakeLists.txt</code>, by adding <code>add_subdirectory(external)</code> to line before <code>src</code> directory is added.<br>
</p>
<div class="org-src-container">
<pre class="src src-cmake" id="org3f1f370"><span class="linenr">15: </span><span style="color: #50fa7b; font-weight: bold;">add_subdirectory</span><span style="color: #f8f8f2;">(</span>external<span style="color: #f8f8f2;">)</span>
<span class="linenr">16: </span><span style="color: #50fa7b; font-weight: bold;">add_subdirectory</span><span style="color: #f8f8f2;">(</span>src<span style="color: #f8f8f2;">)</span>
</pre>
</div>

<p>
Lastly, we need to tell <code>src\CMakeLists.txt</code> to consume <code>libtcod</code>.<br>
</p>
<div class="org-src-container">
<pre class="src src-cmake" id="org4ff7ab9"><span class="linenr">17: </span><span style="color: #50fa7b; font-weight: bold;">target_include_directories</span><span style="color: #f8f8f2;">(</span>rogue PRIVATE $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_INCLUDE</span><span style="color: #8be9fd;">}</span><span style="color: #f8f8f2;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #50fa7b; font-weight: bold;">target_link_libraries</span><span style="color: #f8f8f2;">(</span>rogue PRIVATE fmt::fmt $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_LIB</span><span style="color: #8be9fd;">}</span><span style="color: #f8f8f2;">)</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #50fa7b; font-weight: bold;">add_dependencies</span><span style="color: #f8f8f2;">(</span>rogue libtcod_bins<span style="color: #f8f8f2;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4532aab" class="outline-4">
<h4 id="org4532aab"><span class="section-number-4">1.2.6</span> libTCOD Test file/executable</h4>
<div class="outline-text-4" id="text-1-2-6">
<p>
Phew, so much CMAKE, we can finally see if all this setup is working.<br>
Let's modify our <code>main.cpp</code> to actually call libtcod<br>
</p>
<div class="org-src-container">
<pre class="src src-cpp" id="org5bf61f8"><span class="linenr"> 1: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">libtcod.hpp</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #bd93f9;">int</span> <span style="color: #50fa7b; font-weight: bold;">main</span><span style="color: #f8f8f2;">()</span>
<span class="linenr"> 4: </span><span style="color: #f8f8f2;">{</span>
<span class="linenr"> 5: </span>    <span style="color: #8be9fd;">TCODConsole</span>::initRoot<span style="color: #8be9fd;">(</span>80,50,<span style="color: #f1fa8c;">"libtcod C++ tutorial"</span>,<span style="color: #8be9fd;">false</span>, TCOD_RENDERER_SDL2<span style="color: #8be9fd;">)</span>;
<span class="linenr"> 6: </span>    <span style="color: #ff79c6; font-weight: bold;">while</span> <span style="color: #8be9fd;">(</span> <span style="color: #8be9fd;">!</span><span style="color: #8be9fd;">TCODConsole</span>::isWindowClosed<span style="color: #bd93f9;">()</span> <span style="color: #8be9fd;">)</span> <span style="color: #8be9fd;">{</span>
<span class="linenr"> 7: </span>       <span style="color: #bd93f9;">TCOD_key_t</span> <span style="color: #f8f8f2;">key</span>;
<span class="linenr"> 8: </span>       <span style="color: #8be9fd;">TCODSystem</span>::checkForEvent<span style="color: #bd93f9;">(</span>TCOD_EVENT_KEY_PRESS,&amp;key,<span style="color: #8be9fd;">NULL</span><span style="color: #bd93f9;">)</span>;
<span class="linenr"> 9: </span>       <span style="color: #8be9fd;">TCODConsole</span>::root-&gt;clear<span style="color: #bd93f9;">()</span>;
<span class="linenr">10: </span>       <span style="color: #8be9fd;">TCODConsole</span>::root-&gt;putChar<span style="color: #bd93f9;">(</span>40,25,<span style="color: #f1fa8c;">'@'</span><span style="color: #bd93f9;">)</span>;
<span class="linenr">11: </span>       <span style="color: #8be9fd;">TCODConsole</span>::flush<span style="color: #bd93f9;">()</span>;
<span class="linenr">12: </span>    <span style="color: #8be9fd;">}</span>
<span class="linenr">13: </span>    <span style="color: #ff79c6; font-weight: bold;">return</span> 0;
<span class="linenr">14: </span><span style="color: #f8f8f2;">}</span>
</pre>
</div>
<p>
Here we are starting a TCODConsole, telling it explicitly to use SDL2. By default, the console will try to use SDL1, we don't want that.<br>
</p>

<p>
Hit build in VSCode, and it should generate <code>rogue.exe</code> in <code>\build\bin</code> directory, as well, copy the necessary libtcod dlls there.<br>
Running the executable, should open a window, with <code>@</code> in the middle of the window. Program does nothing else, for now&#x2026;<br>
</p>

<p>
<a href="https://github.com/Roy-Fokker/roguelike/tree/f9022f035ffb9e36ed6bdbbfad7e1303180249e4">Git Repo on 2019/10/06</a><br>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org06a48ab" class="outline-2">
<h2 id="org06a48ab"><span class="section-number-2">2</span> Drawing Player and Moving around</h2>
<div class="outline-text-2" id="text-2">
<p>
<b>NOTE</b>: A word about the code and explainations, I won't be explaining every feature of C++ being used. Perhaps, you are new to C++, but not new to programming, code should make sense to you. For any keywords, or classes from Standard Library that are new for you, I suggest looking it up in <a href="https://www.cppreference.com">Cpp Reference</a>. In general, I write C++ heavily influenced by <a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines">C++ Core Guidelines</a>, code is formatted in <a href="https://en.wikipedia.org/wiki/Indentation_style#Allman_style">Allman style</a>. You might prefer some other styles/means, feel free to write in a way that is comfortable to you.<br>
</p>

<p>
From here on out, we are going to focus on our rogue game. Rest of this document follows similar structure as Python RogueLike Tutorials.<br>
There will be some differences, as C++ and Python are different languages, and operate with different mindsets.<br>
</p>

<p>
Looking at the <a href="http://www.rogueliketutorials.com/tutorials/tcod/">Roguelike Tutorials</a> - Part 1, we've already written some of the Console Startup code in our <code>main.cpp</code>.<br>
For this section, our goals are:<br>
</p>
<ul class="org-ul">
<li>handle input, so '<code>@</code>' moves around<br></li>
<li>catch when '<code>ESC</code>' key is pressed to exit from game<br></li>
<li>catch when '<code>Alt+Enter</code>' key combination is pressed to toggle fullscreen mode<br></li>
<li>load a custom font for displaying characters on screen<br></li>
</ul>
<p>
All of this will be done by modifying our <code>src\main.cpp</code>.<br>
</p>
</div>
<div id="outline-container-org5d697b7" class="outline-3">
<h3 id="org5d697b7"><span class="section-number-3">2.1</span> <code>src\main.cpp</code></h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-cpp" id="orgf8fc670"><span class="linenr">  1: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">libtcod.hpp</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr">  2: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">string</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr">  3: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">utility</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr">  4: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">cassert</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr">  5: </span><span style="color: #ffb86c;">#include</span> <span style="color: #f8f8f2;">&lt;</span><span style="color: #f1fa8c;">any</span><span style="color: #f8f8f2;">&gt;</span>
<span class="linenr">  6: </span>
<span class="linenr">  7: </span><span style="color: #ff79c6; font-weight: bold;">using</span> <span style="color: #ff79c6; font-weight: bold;">namespace</span> <span style="color: #8be9fd;">std</span>::<span style="color: #8be9fd;">literals</span>;
<span class="linenr">  8: </span>
<span class="linenr">  9: </span><span style="color: #ff79c6; font-weight: bold;">using</span> <span style="color: #bd93f9;">console</span> = TCODConsole;
<span class="linenr"> 10: </span>
<span class="linenr"> 11: </span><span style="color: #ff79c6; font-weight: bold;">enum</span> <span style="color: #ff79c6; font-weight: bold;">class</span> <span style="color: #bd93f9;">actions</span>
<span class="linenr"> 12: </span><span style="color: #f8f8f2;">{</span>
<span class="linenr"> 13: </span>    <span style="color: #f8f8f2;">do_nothing</span>,
<span class="linenr"> 14: </span>    <span style="color: #f8f8f2;">exit</span>,
<span class="linenr"> 15: </span>    <span style="color: #f8f8f2;">move</span>,
<span class="linenr"> 16: </span>    <span style="color: #f8f8f2;">fullscreen_toggle</span>,
<span class="linenr"> 17: </span><span style="color: #f8f8f2;">}</span>;
<span class="linenr"> 18: </span>
<span class="linenr"> 19: </span><span style="color: #ff79c6; font-weight: bold;">using</span> <span style="color: #bd93f9;">move_dir</span> = <span style="color: #8be9fd;">std</span>::<span style="color: #bd93f9;">pair</span><span style="color: #f8f8f2;">&lt;</span><span style="color: #bd93f9;">int</span>, <span style="color: #bd93f9;">int</span><span style="color: #f8f8f2;">&gt;</span>;
<span class="linenr"> 20: </span>
<span class="linenr"> 21: </span><span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #50fa7b; font-weight: bold;">handle_input</span><span style="color: #f8f8f2;">()</span> -&gt; <span style="color: #8be9fd;">std</span>::<span style="color: #bd93f9;">pair</span><span style="color: #f8f8f2;">&lt;</span><span style="color: #bd93f9;">actions</span>, <span style="color: #8be9fd;">std</span>::any<span style="color: #f8f8f2;">&gt;</span>
<span class="linenr"> 22: </span><span style="color: #f8f8f2;">{</span>
<span class="linenr"> 23: </span>    <span style="color: #ff79c6; font-weight: bold;">using</span> <span style="color: #bd93f9;">key_code</span> = TCOD_keycode_t;
<span class="linenr"> 24: </span>    <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">key</span> = <span style="color: #8be9fd;">console</span>::checkForKeypress<span style="color: #8be9fd;">()</span>;
<span class="linenr"> 25: </span>
<span class="linenr"> 26: </span>    <span style="color: #ff79c6; font-weight: bold;">switch</span> <span style="color: #8be9fd;">(</span>key.vk<span style="color: #8be9fd;">)</span>
<span class="linenr"> 27: </span>    <span style="color: #8be9fd;">{</span>
<span class="linenr"> 28: </span>        <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">key_code</span>::TCODK_ESCAPE:
<span class="linenr"> 29: </span>            <span style="color: #ff79c6; font-weight: bold;">return</span> <span style="color: #bd93f9;">{</span><span style="color: #8be9fd;">actions</span>::exit, 0<span style="color: #bd93f9;">}</span>;
<span class="linenr"> 30: </span>        <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">key_code</span>::TCODK_UP:
<span class="linenr"> 31: </span>            <span style="color: #ff79c6; font-weight: bold;">return</span> <span style="color: #bd93f9;">{</span><span style="color: #8be9fd;">actions</span>::move, move_dir<span style="color: #ff79c6;">{</span>0, -1<span style="color: #ff79c6;">}</span><span style="color: #bd93f9;">}</span>;
<span class="linenr"> 32: </span>        <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">key_code</span>::TCODK_DOWN:
<span class="linenr"> 33: </span>            <span style="color: #ff79c6; font-weight: bold;">return</span> <span style="color: #bd93f9;">{</span><span style="color: #8be9fd;">actions</span>::move, move_dir<span style="color: #ff79c6;">{</span>0, 1<span style="color: #ff79c6;">}</span><span style="color: #bd93f9;">}</span>;
<span class="linenr"> 34: </span>        <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">key_code</span>::TCODK_LEFT:
<span class="linenr"> 35: </span>            <span style="color: #ff79c6; font-weight: bold;">return</span> <span style="color: #bd93f9;">{</span><span style="color: #8be9fd;">actions</span>::move, move_dir<span style="color: #ff79c6;">{</span>-1, 0<span style="color: #ff79c6;">}</span><span style="color: #bd93f9;">}</span>;
<span class="linenr"> 36: </span>        <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">key_code</span>::TCODK_RIGHT:
<span class="linenr"> 37: </span>            <span style="color: #ff79c6; font-weight: bold;">return</span> <span style="color: #bd93f9;">{</span><span style="color: #8be9fd;">actions</span>::move, move_dir<span style="color: #ff79c6;">{</span>1, 0<span style="color: #ff79c6;">}</span><span style="color: #bd93f9;">}</span>;
<span class="linenr"> 38: </span>        <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">key_code</span>::TCODK_ENTER:
<span class="linenr"> 39: </span>        <span style="color: #bd93f9;">{</span>
<span class="linenr"> 40: </span>            <span style="color: #ff79c6; font-weight: bold;">if</span> <span style="color: #ff79c6;">(</span>key.lalt <span style="color: #ff79c6; font-weight: bold;">or</span> key.ralt<span style="color: #ff79c6;">)</span>
<span class="linenr"> 41: </span>            <span style="color: #ff79c6;">{</span>
<span class="linenr"> 42: </span>                <span style="color: #ff79c6; font-weight: bold;">return</span> <span style="color: #ffb86c;">{</span><span style="color: #8be9fd;">actions</span>::fullscreen_toggle, 0<span style="color: #ffb86c;">}</span>;
<span class="linenr"> 43: </span>            <span style="color: #ff79c6;">}</span>
<span class="linenr"> 44: </span>            <span style="color: #ff79c6; font-weight: bold;">break</span>;
<span class="linenr"> 45: </span>        <span style="color: #bd93f9;">}</span>
<span class="linenr"> 46: </span>    <span style="color: #8be9fd;">}</span>
<span class="linenr"> 47: </span>
<span class="linenr"> 48: </span>    <span style="color: #ff79c6; font-weight: bold;">return</span> <span style="color: #8be9fd;">{}</span>; <span style="color: #6272a4;">// </span><span style="color: #6272a4;">will automatically return actions::do_nothing</span>
<span class="linenr"> 49: </span><span style="color: #f8f8f2;">}</span>
<span class="linenr"> 50: </span>
<span class="linenr"> 51: </span><span style="color: #bd93f9;">int</span> <span style="color: #50fa7b; font-weight: bold;">main</span><span style="color: #f8f8f2;">()</span>
<span class="linenr"> 52: </span><span style="color: #f8f8f2;">{</span>
<span class="linenr"> 53: </span>    <span style="color: #ff79c6; font-weight: bold;">constexpr</span> <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">window_width</span>  = 100,
<span class="linenr"> 54: </span>                   <span style="color: #f8f8f2;">window_height</span> = 56;
<span class="linenr"> 55: </span>    <span style="color: #ff79c6; font-weight: bold;">constexpr</span> <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">window_title</span>  = <span style="color: #f1fa8c;">"Rogue C++ Tutorial - Part 1"</span>sv,
<span class="linenr"> 56: </span>                   <span style="color: #f8f8f2;">font_file</span>     = <span style="color: #f1fa8c;">"arial10x10.png"</span>sv;
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>    <span style="color: #8be9fd;">console</span>::setCustomFont<span style="color: #8be9fd;">(</span>font_file.data<span style="color: #bd93f9;">()</span>, TCOD_FONT_TYPE_GREYSCALE | TCOD_FONT_LAYOUT_TCOD<span style="color: #8be9fd;">)</span>;
<span class="linenr"> 59: </span>
<span class="linenr"> 60: </span>    <span style="color: #8be9fd;">console</span>::initRoot<span style="color: #8be9fd;">(</span>window_width, window_height,
<span class="linenr"> 61: </span>                      window_title.data<span style="color: #bd93f9;">()</span>,
<span class="linenr"> 62: </span>                      <span style="color: #8be9fd;">false</span>, TCOD_RENDERER_SDL2<span style="color: #8be9fd;">)</span>;
<span class="linenr"> 63: </span>    atexit<span style="color: #8be9fd;">(</span>TCOD_quit<span style="color: #8be9fd;">)</span>; <span style="color: #6272a4;">// </span><span style="color: #6272a4;">the C-Runtime will automatically call this function.</span>
<span class="linenr"> 64: </span>
<span class="linenr"> 65: </span>    <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">game_console</span> = console<span style="color: #8be9fd;">(</span>window_width, window_height<span style="color: #8be9fd;">)</span>;
<span class="linenr"> 66: </span>
<span class="linenr"> 67: </span>    <span style="color: #bd93f9;">bool</span> <span style="color: #f8f8f2;">exit_game</span> = <span style="color: #8be9fd;">false</span>;
<span class="linenr"> 68: </span>    <span style="color: #bd93f9;">int</span> <span style="color: #f8f8f2;">player_x</span> = window_width / 2, 
<span class="linenr"> 69: </span>        <span style="color: #f8f8f2;">player_y</span> = window_height / 2;
<span class="linenr"> 70: </span>    <span style="color: #ff79c6; font-weight: bold;">while</span> <span style="color: #8be9fd;">(</span><span style="color: #ff79c6; font-weight: bold;">not</span> <span style="color: #bd93f9;">(</span><span style="color: #8be9fd;">console</span>::isWindowClosed<span style="color: #ff79c6;">()</span> <span style="color: #ff79c6; font-weight: bold;">or</span> exit_game<span style="color: #bd93f9;">)</span><span style="color: #8be9fd;">)</span>
<span class="linenr"> 71: </span>    <span style="color: #8be9fd;">{</span>
<span class="linenr"> 72: </span>        <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">action</span> = handle_input<span style="color: #bd93f9;">()</span>;
<span class="linenr"> 73: </span>        <span style="color: #ff79c6; font-weight: bold;">switch</span> <span style="color: #bd93f9;">(</span>action.first<span style="color: #bd93f9;">)</span>
<span class="linenr"> 74: </span>        <span style="color: #bd93f9;">{</span>
<span class="linenr"> 75: </span>            <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">actions</span>::do_nothing:
<span class="linenr"> 76: </span>                <span style="color: #ff79c6; font-weight: bold;">break</span>;
<span class="linenr"> 77: </span>            <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">actions</span>::exit:
<span class="linenr"> 78: </span>                exit_game = <span style="color: #8be9fd;">true</span>;
<span class="linenr"> 79: </span>                <span style="color: #ff79c6; font-weight: bold;">break</span>;
<span class="linenr"> 80: </span>            <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">actions</span>::move:
<span class="linenr"> 81: </span>            <span style="color: #ff79c6;">{</span>
<span class="linenr"> 82: </span>                <span style="color: #ff79c6; font-weight: bold;">auto</span> <span style="color: #f8f8f2;">dir</span> = <span style="color: #8be9fd;">std</span>::any_cast<span style="color: #ffb86c;">&lt;</span><span style="color: #bd93f9;">move_dir</span><span style="color: #ffb86c;">&gt;(</span>action.second<span style="color: #ffb86c;">)</span>;
<span class="linenr"> 83: </span>                player_x += dir.first;
<span class="linenr"> 84: </span>                player_y += dir.second;
<span class="linenr"> 85: </span>                <span style="color: #ff79c6; font-weight: bold;">break</span>;
<span class="linenr"> 86: </span>            <span style="color: #ff79c6;">}</span>
<span class="linenr"> 87: </span>            <span style="color: #ff79c6; font-weight: bold;">case</span> <span style="color: #8be9fd;">actions</span>::fullscreen_toggle:
<span class="linenr"> 88: </span>            <span style="color: #ff79c6;">{</span>
<span class="linenr"> 89: </span>                game_console.setFullscreen<span style="color: #ffb86c;">(</span><span style="color: #ff79c6; font-weight: bold;">not</span> game_console.isFullscreen<span style="color: #50fa7b;">()</span><span style="color: #ffb86c;">)</span>;
<span class="linenr"> 90: </span>                <span style="color: #ff79c6; font-weight: bold;">break</span>;
<span class="linenr"> 91: </span>            <span style="color: #ff79c6;">}</span>
<span class="linenr"> 92: </span>            <span style="color: #ff79c6; font-weight: bold;">default</span>:
<span class="linenr"> 93: </span>                assert<span style="color: #ff79c6;">(</span><span style="color: #8be9fd;">false</span><span style="color: #ff79c6;">)</span>; <span style="color: #6272a4;">// </span><span style="color: #6272a4;">We forgot to handle some action. DEBUG!</span>
<span class="linenr"> 94: </span>        <span style="color: #bd93f9;">}</span>
<span class="linenr"> 95: </span>
<span class="linenr"> 96: </span>        game_console.clear<span style="color: #bd93f9;">()</span>;
<span class="linenr"> 97: </span>        game_console.setDefaultForeground<span style="color: #bd93f9;">(</span><span style="color: #8be9fd;">TCODColor</span>::white<span style="color: #bd93f9;">)</span>;
<span class="linenr"> 98: </span>        game_console.putChar<span style="color: #bd93f9;">(</span>player_x, player_y, <span style="color: #f1fa8c;">'@'</span><span style="color: #bd93f9;">)</span>;
<span class="linenr"> 99: </span>
<span class="linenr">100: </span>        <span style="color: #8be9fd;">console</span>::blit<span style="color: #bd93f9;">(</span>&amp;game_console, 0, 0, window_width, window_height, 
<span class="linenr">101: </span>                      <span style="color: #8be9fd;">console</span>::root, 0, 0<span style="color: #bd93f9;">)</span>;
<span class="linenr">102: </span>        <span style="color: #8be9fd;">console</span>::flush<span style="color: #bd93f9;">()</span>;
<span class="linenr">103: </span>    <span style="color: #8be9fd;">}</span>
<span class="linenr">104: </span>
<span class="linenr">105: </span>    <span style="color: #ff79c6; font-weight: bold;">return</span> 0;
<span class="linenr">106: </span><span style="color: #f8f8f2;">}</span>
</pre>
</div>
<p>
Here's how it breaks down:<br>
</p>
<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Line #</th>
<th scope="col" class="org-left">Explaination</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1-4</td>
<td class="org-left">We will be using functionality from these headers</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>libtcod</code>: this is the rendering library we are using.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>string</code>: Standard C++ string library</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>utility</code>: contains <code>std::pair</code> type.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>any</code>: for <code>std::any</code> type.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>cassert</code>: this will bring in <code>assert</code> macro. Helps with Debugging.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">7</td>
<td class="org-left">import namespace <code>std::literals</code>, so we can use string literals to for text</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">9</td>
<td class="org-left">I don't want to constantly be typing <code>TCODxxxx</code>, so we setup <code>console</code> as an Alias for <code>TCODConsole</code>, with help of <code>using</code> statement.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">11-17</td>
<td class="org-left">These are actions we will be performing in this game. List will eventually get larger.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">19</td>
<td class="org-left">Define <code>move_dir</code> (move direction) as simple pair of integers, using <code>std::pair</code>.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">21-49</td>
<td class="org-left">This function handles our input. I am using "Trailing Return Type" format for function signature.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">For each key press we are interested in, this function will translate it into our actions enumeration</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Additionally, since we are returning a pair of "things", 2nd value can be anything (std::any).</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">23</td>
<td class="org-left"><code>libtcod</code> is actually a C library. So it tends to define enums in a C-style. Generally, in C++ it's recommended to use strong enum.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Here I am just aliasing it to help with intellisense in VSCode.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">53-55</td>
<td class="org-left">define width, height and title to use with console window. these are constexpr they'll get evaluated at compile time.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>"xxx"sv</code> means create this as a <code>std::string_view</code>, more type safe than using <code>char[]</code> or <code>char*</code>.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">56</td>
<td class="org-left">This is the font file we will be using. It will be placed in <code>build\bin\</code> directory by CMake.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">58</td>
<td class="org-left">tell libTcod that we want to use a custom font file.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">60</td>
<td class="org-left">use the variables we defined above to launch the console.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">63</td>
<td class="org-left">Make sure that we call <code>TCOD_quit()</code> when the application exits.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">65</td>
<td class="org-left">Get an instance of console. Instead of using root console.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">67-69</td>
<td class="org-left">Some game specific variables,</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">If <code>exit_game</code> is true, we will exit the loop</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left"><code>player_x</code> and <code>player_y</code> will control where the "@" character will be drawn.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">70</td>
<td class="org-left">C++ defines <code>not</code>, <code>or</code>, <code>and</code>, et.al as <a href="https://en.cppreference.com/w/cpp/language/operator_alternative">keywords</a>. I prefer to use these in <code>if</code> statements, imo makes the condition easier to read.</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">Keep in mind VSCode's C++ parser does not understand these, so it flags them as error. This is <a href="https://github.com/microsoft/vscode-cpptools/issues/1589">a bug in VSCode's C/C++ Extension.</a></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">72</td>
<td class="org-left">Call our input handling function, that we defined on line 21.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">73-94</td>
<td class="org-left">Simple <code>switch</code> on <code>action</code>. <code>.first</code> here reads the 1st value of the pair that we returned from <code>handle_input</code>.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">82</td>
<td class="org-left">because 2nd value of our pair is a <code>std::any</code> we have to use <code>std::any_cast</code> to go back to the type we put in.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">83-84</td>
<td class="org-left">Update the value of player position using first and second value of the pair we got from line 82.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">87-91</td>
<td class="org-left">Toggle fullscreen mode, by simple negation of current window state.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">96</td>
<td class="org-left">Clear the console, so we have clean canvas</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">97</td>
<td class="org-left">Set foreground color to White</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">89</td>
<td class="org-left">Update the position of "@" using <code>player_x</code> and <code>player_y</code>.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">100</td>
<td class="org-left">Blit our <code>game_console</code> on to <code>root</code> console.</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">102</td>
<td class="org-left">Flush whole thing to screen.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org723fa4b" class="outline-3">
<h3 id="org723fa4b"><span class="section-number-3">2.2</span> <code>external\CMakeLists.txt</code></h3>
<div class="outline-text-3" id="text-2-2">
<p>
At present we don't have any font texture in our <code>build\bin</code> folder. So like we did in <code>Setup</code> section we are going to tell CMake to copy that file over.<br>
We'll do this by appending the copy command to our list of commands in <code>add_custom_target</code> function.<br>
</p>
<div class="org-src-container">
<pre class="src src-cmake" id="org30c9b39"><span class="linenr"> 7: </span><span style="color: #50fa7b; font-weight: bold;">add_custom_target</span><span style="color: #f8f8f2;">(</span>LIBTCOD_BINS
<span class="linenr"> 8: </span>    COMMAND $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">CMAKE_COMMAND</span><span style="color: #8be9fd;">}</span> -E copy $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_DIR</span><span style="color: #8be9fd;">}</span>/libtcod.dll $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">EXECUTABLE_OUTPUT_PATH</span><span style="color: #8be9fd;">}</span>
<span class="linenr"> 9: </span>    COMMAND $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">CMAKE_COMMAND</span><span style="color: #8be9fd;">}</span> -E copy $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_DIR</span><span style="color: #8be9fd;">}</span>/sdl2.dll $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">EXECUTABLE_OUTPUT_PATH</span><span style="color: #8be9fd;">}</span>
<span class="linenr">10: </span>    COMMAND $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">CMAKE_COMMAND</span><span style="color: #8be9fd;">}</span> -E copy $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">LIBTCOD_DIR</span><span style="color: #8be9fd;">}</span>/data/fonts/arial10x10.png $<span style="color: #8be9fd;">{</span><span style="color: #f8f8f2;">EXECUTABLE_OUTPUT_PATH</span><span style="color: #8be9fd;">}</span>
<span class="linenr">11: </span><span style="color: #f8f8f2;">)</span>
</pre>
</div>

<p>
<a href="https://github.com/Roy-Fokker/roguelike/tree/44243e03c1b23bf43eec4efc21542980456219bd">Git Repo on 2019/10/07</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-orgc7084c1" class="outline-2">
<h2 id="orgc7084c1"><span class="section-number-2">3</span> Entity System</h2>
</div>

<div id="outline-container-orgd99cb7c" class="outline-2">
<h2 id="orgd99cb7c"><span class="section-number-2">4</span> Generating a Dungeon</h2>
</div>

<div id="outline-container-org7774e76" class="outline-2">
<h2 id="org7774e76"><span class="section-number-2">5</span> Field of View</h2>
</div>

<div id="outline-container-org95fd8ee" class="outline-2">
<h2 id="org95fd8ee"><span class="section-number-2">6</span> Placing Enemies</h2>
</div>

<div id="outline-container-org81606a3" class="outline-2">
<h2 id="org81606a3"><span class="section-number-2">7</span> Combat Loop</h2>
</div>

<div id="outline-container-org978218c" class="outline-2">
<h2 id="org978218c"><span class="section-number-2">8</span> User Interface</h2>
</div>

<div id="outline-container-org68104e5" class="outline-2">
<h2 id="org68104e5"><span class="section-number-2">9</span> Items and Inventory</h2>
</div>

<div id="outline-container-org9e744e2" class="outline-2">
<h2 id="org9e744e2"><span class="section-number-2">10</span> Equiping Items</h2>
</div>

<div id="outline-container-org2d6d3b3" class="outline-2">
<h2 id="org2d6d3b3"><span class="section-number-2">11</span> Weapons and Targetting</h2>
</div>

<div id="outline-container-org0f71b10" class="outline-2">
<h2 id="org0f71b10"><span class="section-number-2">12</span> Saving and Loading Game State</h2>
</div>

<div id="outline-container-org72eacd7" class="outline-2">
<h2 id="org72eacd7"><span class="section-number-2">13</span> Dungeon Delving</h2>
</div>

<div id="outline-container-org09d6aed" class="outline-2">
<h2 id="org09d6aed"><span class="section-number-2">14</span> Difficulty Curve</h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Neel Raiyani</p>
<p class="date">Created: 2019-10-07 Mon 22:50</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
